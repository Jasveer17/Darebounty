// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  CREATOR
  PARTICIPANT
  ADMIN
}

enum DareStatus {
  OPEN
  CLOSED
  PAID
}

enum ProofType {
  URL
  URL_IMAGE
}

enum SubmissionStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum PayoutStatus {
  PENDING
  SENT
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  clerkId   String?  @unique
  role      UserRole @default(PARTICIPANT)
  createdAt DateTime @default(now())

  createdDares Dare[]       @relation("CreatorDares")
  submissions  Submission[]
  messages     Message[]

  @@index([email])
  @@index([clerkId])
}

model Dare {
  id           String     @id @default(cuid())
  creatorId    String
  title        String
  description  String     @db.Text
  proofType    ProofType
  totalReward  Float
  winnerCount  Int
  deadline     DateTime
  status       DareStatus @default(OPEN)
  createdAt    DateTime   @default(now())

  creator     User         @relation("CreatorDares", fields: [creatorId], references: [id])
  submissions Submission[]
  payouts     Payout[]
  messages    Message[]

  @@index([creatorId])
  @@index([status])
}

model Submission {
  id            String           @id @default(cuid())
  dareId        String
  participantId String
  proofUrl      String
  proofImage    String?
  note          String?          @db.Text
  status        SubmissionStatus @default(PENDING)
  createdAt     DateTime         @default(now())

  dare        Dare     @relation(fields: [dareId], references: [id])
  participant User     @relation(fields: [participantId], references: [id])
  payouts     Payout[]

  @@unique([dareId, participantId])
  @@index([dareId])
  @@index([participantId])
  @@index([status])
}

model Payout {
  id               String       @id @default(cuid())
  dareId           String
  submissionId     String
  amount           Float
  status           PayoutStatus @default(PENDING)
  stripeTransferId String?
  createdAt        DateTime     @default(now())

  dare       Dare       @relation(fields: [dareId], references: [id])
  submission Submission @relation(fields: [submissionId], references: [id])

  @@index([dareId])
  @@index([submissionId])
  @@index([status])
}

model Message {
  id        String   @id @default(cuid())
  dareId    String
  senderId  String
  message   String   @db.Text
  createdAt DateTime @default(now())

  dare   Dare @relation(fields: [dareId], references: [id])
  sender User @relation(fields: [senderId], references: [id])

  @@index([dareId])
  @@index([createdAt])
}
